<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://byeol.ga">
  <title>iOS关联（Associative References） | Byeol.Kwok&#39;s Memo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Objective-C Runtime(Associative References)// Sets an associated value for a given object using a given key and association policy.
OBJC_EXPORT void objc_setAssociatedObject(id object, const void *key">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS关联（Associative References）">
<meta property="og:url" content="http://byeol.ga/2016/11/24/iOS关联（Associative References）/index.html">
<meta property="og:site_name" content="Byeol.Kwok's Memo">
<meta property="og:description" content="Objective-C Runtime(Associative References)// Sets an associated value for a given object using a given key and association policy.
OBJC_EXPORT void objc_setAssociatedObject(id object, const void *key">
<meta property="og:updated_time" content="2016-11-25T06:59:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS关联（Associative References）">
<meta name="twitter:description" content="Objective-C Runtime(Associative References)// Sets an associated value for a given object using a given key and association policy.
OBJC_EXPORT void objc_setAssociatedObject(id object, const void *key">
  
    <link rel="alternative" href="/atom.xml" title="Byeol.Kwok&#39;s Memo" type="application/atom+xml">
  
  
    <link rel="icon" href="/uploads/avatar.png">
  
  <link rel="stylesheet" href="/main.css">
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay">
	<hgroup>
		<h1 class="header-title"><a href="/">Byeol.Kwok&#39;s Memo</a></h1>
	</hgroup>

	
		<p class="header-subtitle">每天学习一点</p>
	
</div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/uploads/avatar.png" class="js-avatar">
			
		</a>
		
		<nav class="header-menu">
			<ul>
				
					<li><a href="/">主页</a></li>
	        	
					<li><a href="/archives">归档</a></li>
	        	
			</ul>
		</nav>
		<nav class="header-smart-menu">
	    	
    		
    			
    				<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">标签</a>
    				
    			
        	
    			
    				<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">关于我</a>
    				
    			
        	
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/xiniur" title="github">github</a>
		    	
					<a class="weibo" target="_blank" href="http://weibo.com/1614763492" title="weibo">weibo</a>
		    	
					<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
		    	
			</div>
		</nav>
	</header>	
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-title js-mobile-header hide">Byeol.Kwok&#39;s Memo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="/uploads/avatar.png" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-title">Byeol.Kwok&#39;s Memo</h1>
			</hgroup>
			
				<p class="header-subtitle">每天学习一点</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">归档</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/xiniur" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/1614763492" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        <article id="post-iOS关联（Associative References）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      iOS关联（Associative References）
    </h1>
  

      </header>
    
    <div class="article-info article-info-index">
      
      <a href="/2016/11/24/iOS关联（Associative References）/" class="archive-article-date">
  	<time datetime="2016-11-24T07:25:06.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-11-24</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Objective-C/">Objective-C</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/记录/">记录</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Objective-C-Runtime-Associative-References"><a href="#Objective-C-Runtime-Associative-References" class="headerlink" title="Objective-C Runtime(Associative References)"></a>Objective-C Runtime(Associative References)</h3><pre><code class="objectivec"><span class="comment">// Sets an associated value for a given object using a given key and association policy.</span>
OBJC_EXPORT <span class="keyword">void</span> objc_setAssociatedObject(<span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key, <span class="keyword">id</span> value, objc_AssociationPolicy policy)
    OBJC_AVAILABLE(<span class="number">10.6</span>, <span class="number">3.1</span>, <span class="number">9.0</span>, <span class="number">1.0</span>);

<span class="comment">// Returns the value associated with a given object for a given key.</span>
OBJC_EXPORT <span class="keyword">id</span> objc_getAssociatedObject(<span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key)
    OBJC_AVAILABLE(<span class="number">10.6</span>, <span class="number">3.1</span>, <span class="number">9.0</span>, <span class="number">1.0</span>);

<span class="comment">// Removes all associations for a given object.</span>
<span class="comment">// The main purpose of this function is to make it easy to return an object to a "pristine state”. You should not use this function for general removal of associations from objects, since it also removes associations that other clients may have added to the object. Typically you should use objc_setAssociatedObject(_:_:_:_:) with a nil value to clear an association.</span>
OBJC_EXPORT <span class="keyword">void</span> objc_removeAssociatedObjects(<span class="keyword">id</span> object)
    OBJC_AVAILABLE(<span class="number">10.6</span>, <span class="number">3.1</span>, <span class="number">9.0</span>, <span class="number">1.0</span>);
</code></pre>
<h3 id="参数解释"><a href="#参数解释" class="headerlink" title="参数解释"></a>参数解释</h3><p>object: 关联的源对象。<br>key: 相当于NSDictionary的键，不同的是关联对象是通过判断两个key的地址是否相等而不是具体的值来比较。<br>value: 关联的对象。<br>objc_AssociationPolicy: 与声明属性对应的内存管理方式。</p>
<table>
<thead>
<tr>
<th>objc_AssociationPolicy</th>
<th style="text-align:center">@property</th>
</tr>
</thead>
<tbody>
<tr>
<td>OBJC_ASSOCIATION_ASSIGN</td>
<td style="text-align:center">(assign)</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_RETAIN_NONATOMIC</td>
<td style="text-align:center">(nonatomic, retain)</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_COPY_NONATOMIC</td>
<td style="text-align:center">(nonatomic, copy)</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_RETAIN</td>
<td style="text-align:center">(retain)</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_COPY</td>
<td style="text-align:center">(copy)</td>
</tr>
</tbody>
</table>
<a id="more"></a>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>　　iOS关联，在不用继承的情况下将现有的两个对象关联起来。如果给现有的类存放一些额外信息，通常是继承一个类，然后定义新增加的属性，然而也可以通过关联给这个对象一个属性，而不用新加子类，在不用继承的情况下将现有的两个对象关联起来，可以对已有的类添加属性。</p>
<pre><code class="objectivec"><span class="keyword">static</span> <span class="keyword">char</span> key;
<span class="comment">//关联的对象</span>
<span class="built_in">NSString</span> *value = <span class="string">@"我是关联的对象"</span>;
<span class="comment">//关联的源对象</span>
<span class="built_in">NSObject</span> *obj = [[<span class="built_in">NSObject</span> alloc] init];

objc_setAssociatedObject(obj, &amp;key,value, OBJC_ASSOCIATION_RETAIN_NONATOMIC);

<span class="built_in">NSString</span> *result = objc_getAssociatedObject(obj, &amp;key);

<span class="built_in">NSLog</span>(<span class="string">@"value = %@ result = %@"</span>, value, result);
</code></pre>
<p>　　关联还可以给对象增加属性，使Category不仅可以为现有类增加方法，还可以增加实例属性。</p>
<pre><code class="objectivec"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span>

<span class="class"><span class="keyword">@interface</span> <span class="title">UILabel</span> (<span class="title">Associate</span>)</span>

<span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *placeholderColor;

<span class="keyword">@end</span>
</code></pre>
<pre><code class="objectivec"><span class="meta">#import <span class="meta-string">"UILabel+Associate.h"</span></span>
<span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span>

<span class="keyword">static</span> <span class="keyword">char</span> placeholderKey;

<span class="class"><span class="keyword">@implementation</span> <span class="title">UILabel</span> (<span class="title">Associate</span>)</span>

- (<span class="keyword">void</span>)setPlaceholderColor:(<span class="built_in">UIColor</span> *)placeholderColor
{
    objc_setAssociatedObject(<span class="keyword">self</span>, &amp;placeholderKey, placeholderColor, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

- (<span class="built_in">UIColor</span> *)placeholderColor
{
    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;placeholderKey);
}

<span class="keyword">@end</span>
</code></pre>
<p>　　还可以关联一个block来简化代码。</p>
<pre><code class="objectivec"><span class="keyword">static</span> <span class="keyword">char</span> alertViewKey;

- (<span class="keyword">void</span>)showAlert {
    <span class="built_in">UIAlertView</span> *alert = [[<span class="built_in">UIAlertView</span> alloc]initWithTitle:<span class="string">@"提示"</span> message:<span class="string">@"我是关联block"</span> delegate:<span class="keyword">self</span> cancelButtonTitle:<span class="string">@"取消"</span> otherButtonTitles:<span class="string">@"确定"</span>, <span class="literal">nil</span>];

    <span class="keyword">void</span> (^alertBlock)(<span class="built_in">NSInteger</span>) = ^(<span class="built_in">NSInteger</span> buttonIndex) {
        <span class="built_in">NSLog</span>(<span class="string">@"我是关联block buttonIndex = %ld"</span>, (<span class="keyword">long</span>)buttonIndex);
    };

    objc_setAssociatedObject(alert, &amp;alertViewKey, alertBlock, OBJC_ASSOCIATION_COPY);<span class="comment">//将block 与alert关联</span>

    [alert show];
}

-(<span class="keyword">void</span>)alertView:(<span class="built_in">UIAlertView</span> *)alertView clickedButtonAtIndex:(<span class="built_in">NSInteger</span>)buttonIndex
{   
    <span class="keyword">void</span>(^ alertBlock)(<span class="built_in">NSInteger</span>) = objc_getAssociatedObject(alertView, &amp;alertViewKey);
    alertBlock(buttonIndex);
}
</code></pre>
<h3 id="断开关联"><a href="#断开关联" class="headerlink" title="断开关联"></a>断开关联</h3><p>　　使用<code>objc_removeAssociatedObjects</code>可以断开所有的关联，使用这个函数会断开所有的关联，把对象恢复到“原始状态”。</p>

      
    </div>
  </div>
</article>

  
<nav id="article-nav">
  
  
    <a href="/2016/11/11/hexo_module_not_found/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Cannot find module DTraceProviderBindings</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>




<div class="duoshuo">
	<div class="ds-share flat" data-thread-key="iOS关联（Associative References）" data-title="iOS关联（Associative References）" data-images="" data-content="" data-url="http://byeol.ga/2016/11/24/iOS关联（Associative References）/">">
    	<div class="ds-share-inline">
      		<ul  class="ds-share-icons-16">
      		<li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
        	<li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
        	<li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
        	<li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
        	<li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
      		</ul>
      		<div class="ds-share-icons-more">
      		</div>
    	</div>
 	</div>
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="iOS关联（Associative References）" data-title="iOS关联（Associative References）" data-url="http://byeol.ga/2016/11/24/iOS关联（Associative References）/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"gohor"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.unstable.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-center">
    		&copy; 2017 Byeol.Kwok  <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a>
      </div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: false
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Objective-C/" style="font-size: 20px;">Objective-C</a> <a href="/tags/Xcode/" style="font-size: 10px;">Xcode</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/探究/" style="font-size: 10px;">探究</a> <a href="/tags/记录/" style="font-size: 15px;">记录</a>
    			</div>
    	</section>
    

    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">有始有卒者，其惟圣人乎！</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>